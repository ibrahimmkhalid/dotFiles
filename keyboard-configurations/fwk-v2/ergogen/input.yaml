units:
  screw_hole_size: 1.2
  half_U: 0.5U
  work_trrs_x: 2.5
  work_trrs_y: 13
  work_trrs_a: -90
  game_trrs_x: 13
  game_trrs_y: 9.5
  game_trrs_a: 0
  work_trrs_pcb_err_x: -14
  work_trrs_pcb_err_y: 3
  game_trrs_pcb_err_x: 2.1
  game_trrs_pcb_err_y: 4.8
  promicro_x: U/2-2
  promicro_y: -1U
  promicro_pcb_err_x: 1
  promicro_pcb_err_y: 0
points:
  zones:
    main:
      columns:
        pinky:
          key:
            column_net: P4
        ring:
          key:
            column_net: P5
            stagger: 7
        middle:
          key:
            column_net: P6
            stagger: 7
        index:
          key:
            column_net: P7
            stagger: -7
        inner:
          key:
            column_net: P8
        extra:
          key:
            column_net: P9
            stagger: -5
      rows:
        bottom:
          row_net: P20
        home:
          row_net: P19
        top:
          row_net: P18
    thumb:
      anchor:
        ref: main_index_bottom
        shift: [0, -2U+16.5]
      columns:
        pos1:
          key:
            column_net: P9
            shift: [-0.1,-U/2]
          rows.cluster.skip: true
        pos2:
          key:
            column_net: P10
            rotate: -10
            shift: [1.55,-1.7]
          rows.wextra.skip: true
          rows.cluster.row_net: P15
        pos3:
          key:
            column_net: P10
            rotate: -20
            shift: [2.45, -7]
          rows.wextra.skip: true
          rows.cluster.row_net: P18
        pos4:
          key:
            column_net: P10
            rotate: -20
            shift: [-U-3.95, -5.75-U]
          rows.wextra.skip: true
          rows.cluster.row_net: P19
        pos5:
          key:
            column_net: P10
            rotate: -20
            shift: [-U-3.05,-U-7]
          rows.wextra.skip: true
          rows.cluster.row_net: P20
      rows:
        cluster:
        wextra:
          row_net: P15
    game:
      anchor:
        shift: [-U,0]
      columns:
        outer:
          key:
            column_net: P3
        pinky:
          key:
            column_net: P4
          rows:
            bottom.skip: true
            home.skip: true
            top.skip: true
        ring:
          key:
            column_net: P5
            stagger: 7
          rows:
            bottom.skip: true
            home.skip: true
            top.skip: true
        middle:
          key:
            column_net: P6
            stagger: 7
          rows:
            bottom.skip: true
            home.skip: true
            top.skip: true
        index:
          key:
            column_net: P7
            stagger: -7
          rows:
            bottom.skip: true
            home.skip: true
            top.skip: true
        inner:
          key:
            column_net: P8
          rows:
            bottom.skip: true
            home.skip: true
            top.skip: true
      rows:
        bottom:
          row_net: P20
        home:
          row_net: P19
        top:
          row_net: P18
        num:
          row_net: P15
outlines:
  _trrs:
    - what: rectangle
      size: [6, 14]
  _promicro:
    - what: rectangle
      size: [33, 17.6]

  _work_connect_polygon:
    - what: polygon
      points:
        - ref: main_middle_top
          shift: [-0.5U, 0.5U]
        - shift: [-U, 0]
        - ref: main_pinky_top
          shift: [-0.5U, 0.5U]
        - ref: main_pinky_bottom
          shift: [-0.5U, -1.5U]
        - ref: thumb_pos4_cluster
          shift: [0.5U,-0.5U]
        - ref: thumb_pos5_cluster
          shift: [0.5U,-0.5U]
        - ref: thumb_pos5_cluster
          shift: [0.5U,0.5U]
        - ref: main_extra_top
          shift: [0.5U, 0.5U]
        - ref: main_extra_top
          shift: [-0.5U, 0.5U]
        - ref: main_inner_top
          shift: [0.5U, 0.5U+7]
        - ref: main_middle_top
          shift: [0.5U, 0.5U]
  _work_screw_holes:
    - what: circle
      radius: screw_hole_size
      where: /^(main_pinky_top|main_middle_bottom|main_extra_top|thumb_pos3_cluster|main_middle_top)/
      adjust:
        shift: [0,-0.5U]
  work_raw_stacked:
    - what: rectangle
      where: /(^main_.*|^thumb_.*)/
      size: [U,U]
      operation: stack
    - what: rectangle
      where: /(^main_.*|^thumb_.*)/
      size: [14,14]
      operation: stack
    - what: outline
      name: _trrs
      where: 
        ref: main_inner_top
        shift: [work_trrs_x,work_trrs_y]
        rotate: work_trrs_a
      operation: stack
    - what: outline
      name: _promicro
      where:
        ref: main_pinky_bottom
        shift: [promicro_x, promicro_y]
      operation: stack
    - what: outline
      name: _work_connect_polygon
      operation: stack
    - what: outline
      name: _work_screw_holes
      operation: stack
  work_pcb:
    - what: outline
      name: _work_connect_polygon
    - what: outline
      name: _work_screw_holes
      operation: subtract
  work_plate:
    - what: outline
      name: _work_connect_polygon
    - what: rectangle
      where: /^main_.*/
      size: [14,14]
      operation: subtract
    - what: rectangle
      where: /^thumb_.*/
      size: [14,14]
      operation: subtract

  _game_connect_polygon:
    - what: polygon
      points:
        - ref: game_middle_num
          shift: [-0.5U, 0.5U]
        - shift: [-U, 0]
        - ref: game_outer_num
          shift: [-0.5U, 0.5U]
        - ref: game_outer_bottom
          shift: [-0.5U, -1.5U]
        - ref: thumb_pos4_cluster
          shift: [0.5U,-0.5U]
        - ref: thumb_pos5_cluster
          shift: [0.5U,-0.5U]
        - ref: thumb_pos5_cluster
          shift: [0.5U,0.5U]
        - orient: 
            ref: main_extra_top
            shift: [0.5U, 0.5U]
        - shift: [0,140]
    - what: polygon
      operation: subtract
      points:
        - ref: game_middle_num
          shift: [-0.5U, 0.5U]
        - shift: [4U, 0]
        - shift: [0,30]
  _game_screw_holes:
    - what: circle
      radius: screw_hole_size
      where: /^(game_outer_num|main_middle_bottom|game_inner_num|thumb_pos3_cluster|game_middle_num)/
      adjust:
        shift: [0,-0.5U]
    - what: circle
      radius: screw_hole_size
      where: main_pinky_bottom
      adjust:
        shift: [0.5U, -0.5U]
  game_raw_stacked:
    - what: outline
      name: _game_connect_polygon
      operation: stack
    - what: outline # _trrs
      name: _trrs
      where: 
        ref: game_inner_num
        shift: [game_trrs_x,game_trrs_y]
        rotate: game_trrs_a
      operation: stack
    - what: outline # pro micro
      name: _promicro
      where:
        ref: game_outer_bottom
        shift: [promicro_x, promicro_y]
      operation: stack
    - what: rectangle # keys
      where: true
      size: [14,14]
      operation: stack
    - what: rectangle # keys
      where: true
      size: [U,U]
      operation: stack
    - what: outline
      name: _game_screw_holes
      operation: stack
  game_pcb:
    - what: outline
      name: _game_connect_polygon
    - what: outline
      name: _game_screw_holes
      operation: subtract
  game_plate:
    - what: outline
      name: _game_connect_polygon
    - what: rectangle
      where: true
      size: [14,14]
      operation: subtract
pcbs:
  work_pcb:
    outlines:
      work_pcb:
        outline: work_pcb
    footprints:
      keys:
        what: mx
        where: /^(main_|thumb_).*/
        params:
          keycaps: true
          hotswap: true
          reverse: true
          from: "{{colrow}}"
          to: "{{column_net}}"
      diodes:
        what: diode
        where: /^(main_|thumb_).*/
        adjust:
          rotate: 180
          shift: [0, -5]
        params:
          from: "{{row_net}}"
          to: "{{colrow}}"
      vias:
        what: via
        where: /^(main_|thumb_).*/
        adjust:
          shift: [0.45U, 7]
        params:
          net: "{{column_net}}"
      promicro:
        what: promicro
        where:
          ref: main_pinky_bottom
          shift: [promicro_x+promicro_pcb_err_x, promicro_y+promicro_pcb_err_y]
      trrs:
        what: trrs
        where: 
          ref: main_extra_top
          shift: [work_trrs_x+work_trrs_pcb_err_x, work_trrs_y+work_trrs_pcb_err_y]
          rotate: work_trrs_a
        params:
          reverse: true
          symmetric: true
          A: GND
          B: GND
          C: P2
          D: VCC
  game_pcb:
    outlines:
      game_pcb:
        outline: game_pcb
    footprints:
      keys:
        what: mx
        where: true
        params:
          keycaps: true
          hotswap: true
          reverse: true
          from: "{{colrow}}"
          to: "{{column_net}}"
      diodes:
        what: diode
        where: true
        adjust:
          rotate: 180
          shift: [0, -5]
        params:
          from: "{{row_net}}"
          to: "{{colrow}}"
      vias:
        what: via
        where: true
        adjust:
          shift: [0.45U, 7]
        params:
          net: "{{column_net}}"
      promicro:
        what: promicro
        where:
          ref: game_outer_bottom
          shift: [promicro_x+promicro_pcb_err_x, promicro_y+promicro_pcb_err_y]
      trrs:
        what: trrs
        where: 
          ref: game_inner_num
          shift: [game_trrs_x+game_trrs_pcb_err_x, game_trrs_y+game_trrs_pcb_err_y]
          rotate: game_trrs_a
        params:
          reverse: true
          symmetric: true
          A: GND
          B: GND
          C: P2
          D: VCC
